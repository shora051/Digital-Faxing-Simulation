from pdf2image import convert_from_path
from PIL import Image
import pytesseract
import re

STEP 1: Load the PDF file
pdf_path = "/Users/hamidatoloko/Downloads/Fax Form Test 1 2.pdf"

# Convert the first page of the PDF to an image
pages = convert_from_path(pdf_path, 300)
fax_image = pages[0]  # Use first page only

STEP 2: Extract text with OCR 
text = pytesseract.image_to_string(fax_image)

print("\n  Extracted Text:\n")
print(text)

 STEP 3: Smart field extraction
def extract_fields(text):
    fields = {
        "PatientName": "",
        "Doctor": "",
        "Medication": "",
        "Date": ""
    }

    lines = [line.strip() for line in text.splitlines() if line.strip()]

    # Extract patient first and last Name
    for i, line in enumerate(lines):
        if "first name" in line.lower():
            try:
                first = lines[i + 1].strip()
                last = lines[i + 2].strip()
                fields["PatientName"] = f"{first} {last}"
                break
            except IndexError:
                continue

    # Extract doctor name (prescriber)
    for i, line in enumerate(lines):
        if "prescriber first name" in line.lower():
            try:
                first = lines[i + 1].strip()
                last = lines[i + 2].strip()
                fields["Doctor"] = f"{first} {last}"
                break
            except IndexError:
                continue

    # Extract medication
    for i, line in enumerate(lines):
        if "drug name" in line.lower():
            for j in range(i + 1, i + 4):
                if j < len(lines) and "tablet" in lines[j].lower():
                    fields["Medication"] = lines[j]
                    break

    # Extract date
    for line in lines:
        if "today" in line.lower() and "date" in line.lower():
            fields["Date"] = line
            break

    return fields

STEP 4: Show structured results
print("\n Structured Fax Data:")
for key, value in extract_fields(text).items():
    print(f"{key}: {value}")
